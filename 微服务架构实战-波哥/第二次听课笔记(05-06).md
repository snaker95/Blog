## 典型的OAuth2 Flow

### [规范](https://tools.ietf.org/html/rfc6749)

### [阮一峰: 理解OAuth 2.0](http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html)

## OAuth2 模式

### 授权码模式

* 最复杂难, 最安全, 应用最多的
* 使用场景: 
  * 第三方授权
* 解读
  * 通过前端渠道**客户**获取授权码
  * 通过后端渠道. **客户**使用authorization code去交换access token和可选的refresh token
  * 假定**资源拥有者**和**客户**在不同的设备上
  * 最安全的流程, 因为立牌不会传递经过user-agent
* ![image-20191122103035473](第二次听课笔记(05-).assets/image-20191122103035473.png)

### 简化模式

* 使用场景
  * 单页应用, 没有后台
* 解读
  * 适用于**公开的**浏览器单页应用
  * Access Token直接从授权服务器返回(只有前端渠道)
  * 不支持refresh tokens
  * 假定资源所有者和公开客户应用在同一设备上
  * 最容易受安全攻击

* ![image-20191122103622682](第二次听课笔记(05-).assets/image-20191122103622682.png)

### 密码模式

* 使用场景
  * 作为API用户登录, 自家客户端和自家API; 例如: 手机号登录
* 解读
  * 使用用户名密码的应用, 例如桌面App
  * 使用用户名密码作为授权方式从授权服务器获取access token
  * 一般不支持refresh tokens
  * 假定资源拥有者和公开客户在相同设备上

* ![image-20191122103655745](第二次听课笔记(05-).assets/image-20191122103655745.png)

### 客户端模式

* 使用场景
  * 服务间授权
* 解读
  * 适用于服务器间通信场景, 机密客户代表它自己或者一个用户
  * 只有后端渠道, 使用客户凭证获取一个access token
  * 因为客户凭证可以使用对称或者非对称加密, 该方式支持共享密码或者证书
* ![image-20191122103723941](第二次听课笔记(05-).assets/image-20191122103723941.png)

## 刷新令牌

![image-20191122103809430](第二次听课笔记(05-).assets/image-20191122103809430.png)



## 授权流程渠道

![image-20191122105041594](第二次听课笔记(05-).assets/image-20191122105041594.png)



## 客户应用类型

![image-20191122105105806](第二次听课笔记(05-).assets/image-20191122105105806.png)

## 怎么选型

![image-20191122110754008](第二次听课笔记(05-).assets/image-20191122110754008.png)

* 解读
  * 如果介入的客户是 **机器** 走 **客户端模式**
  * 如果接入的客户是**单页应用SPA**, 分为 **第一方** 和 **第三方**
    * **第一方** 走 **密码模式**
    * **第三方** 走 **简化模式**
  * 如果接入的客户是 **原生App**, 分为  **第一方** 和 **第三方**
    * **第一方** 走 **密码模式**
    * **第三方** 走 **授权模式**

